<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talent Directory | Filterable Profiles</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom scrollbar for better aesthetics */
        body::-webkit-scrollbar {
            width: 8px;
        }
        body::-webkit-scrollbar-thumb {
            background-color: #A78BFA;
            border-radius: 4px;
        }
        body::-webkit-scrollbar-track {
            background-color: #f3f4f6;
        }
        /* Custom styles for the filter box shadow */
        .filter-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Style for the detail view to ensure scrollability */
        .detail-card {
            max-width: 1200px;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans antialiased text-gray-800">

    <!-- Main Application Container -->
    <div id="app" class="flex min-h-screen">
        
        <!-- All List Content: Sidebar + Results Grid (Visible by default) -->
        <div id="main-content-list" class="flex flex-col lg:flex-row flex-grow">
            
            <!-- Filter Sidebar -->
            <aside id="sidebar" class="w-full lg:w-80 bg-white border-b lg:border-r border-gray-200 p-6 lg:p-8 shrink-0 filter-shadow">
                <h1 class="text-3xl font-extrabold text-indigo-600 mb-6 flex items-center">
                    Talent Hub
                </h1>
                
                <div id="auth-status" class="mb-6 text-sm text-gray-600">
                    <p>Status: <span id="user-status" class="font-semibold text-green-600">Public Access</span></p>
                </div>

                <div class="space-y-8">
                    <!-- Skills Filter -->
                    <div>
                        <label for="skills-filter" class="block text-sm font-bold text-gray-700 mb-2">Filter by Skills</label>
                        <div class="relative">
                            <input type="text" id="skills-filter" placeholder="e.g., React, Node.js, Design" 
                                   class="w-full pl-10 pr-4 py-2 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                <i data-lucide="search" class="w-5 h-5"></i>
                            </span>
                        </div>
                    </div>

                    <!-- Experience Filter -->
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <label for="experience-filter" class="block text-sm font-bold text-gray-700">Minimum Experience (Years)</label>
                            <span id="experience-value" class="text-indigo-600 font-extrabold text-lg">0+</span>
                        </div>
                        <input type="range" id="experience-filter" min="0" max="20" value="0" step="1"
                               class="w-full h-2 bg-indigo-100 rounded-lg appearance-none cursor-pointer range-lg transition duration-150">
                    </div>

                    <!-- Clear Filters Button -->
                    <button id="clear-filters" class="w-full flex items-center justify-center bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300 transition duration-300 font-medium">
                        <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
                        Clear Filters
                    </button>
                </div>
            </aside>

            <!-- Profile Results Area -->
            <main id="main-results-area" class="flex-grow p-6 lg:p-10">
                <h2 class="text-2xl lg:text-3xl font-bold text-gray-700 mb-8">
                    Found <span id="results-count" class="text-indigo-600">0</span> Profiles
                </h2>

                <!-- Loading Spinner -->
                <div id="loading" class="flex justify-center items-center h-48">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-500"></div>
                    <p class="ml-4 text-indigo-500">Loading profiles from backend...</p>
                </div>

                <!-- User Cards Grid -->
                <div id="user-cards-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    <!-- Profile Cards will be injected here -->
                </div>

                <!-- No Results Message -->
                <div id="no-results" class="hidden text-center p-10 bg-white rounded-xl border border-gray-200 mt-8">
                    <p class="text-xl font-semibold text-gray-500">No matching profiles found.</p>
                    <p class="text-gray-400 mt-2">Try adjusting your skill or experience filters.</p>
                </div>
            </main>
        </div>
        
        <!-- User Detail Full-Page View (Hidden by default) -->
        <div id="user-detail-view" class="hidden flex-grow p-6 lg:p-10">
            <!-- Content injected by JS -->
            <div class="detail-card bg-white rounded-xl shadow-lg p-8">
                <button onclick="showListView()" class="mb-6 inline-flex items-center text-indigo-600 hover:text-indigo-800 transition duration-150 font-semibold">
                    <i data-lucide="arrow-left" class="w-5 h-5 mr-2"></i>
                    Back to Directory
                </button>
                <div id="user-detail-content">
                    <!-- Detailed profile content injected here by JS -->
                </div>
            </div>
        </div>

    </div>
    
    <script type="module">
        // Base URL for API calls
        const BASE_URL = 'https://www.winjob.in'; 
        
        // --- Application State ---
        let state = {
            allUsers: [],
            filteredUsers: [],
            filters: {
                skills: '',
                experience: 0
            },
            isAuthReady: true // Set to true as no auth is required
        };

        // --- DOM Elements ---
        const mainContentList = document.getElementById('main-content-list');
        const userDetailView = document.getElementById('user-detail-view');
        const userDetailContent = document.getElementById('user-detail-content');
        const userCardsContainer = document.getElementById('user-cards-container');
        const resultsCountSpan = document.getElementById('results-count');
        const loadingDiv = document.getElementById('loading');
        const noResultsDiv = document.getElementById('no-results');
        const skillsFilterInput = document.getElementById('skills-filter');
        const experienceFilterInput = document.getElementById('experience-filter');
        const experienceValueSpan = document.getElementById('experience-value');
        const clearFiltersButton = document.getElementById('clear-filters');


        /**
         * Calculates the total professional experience in years, based on start and end dates.
         * Experience is calculated with high decimal precision using milliseconds.
         * It prioritizes the 'fromDate' field and uses the current date for ongoing jobs 
         * (when 'toDate' is missing or 'isCurrent' is true).
         * * @param {Array} professionalDetails - Array of job objects, expecting 'fromDate', 'toDate', 'isCurrent'.
         * @returns {number} Total experience in years, rounded to two decimal places.
         */
        function calculateTotalExperience(professionalDetails) {
            if (!Array.isArray(professionalDetails) || professionalDetails.length === 0) {
                return 0;
            }

            // Using 365.25 days per year accounts for leap years, giving a more accurate calculation.
            const MS_PER_YEAR = 1000 * 60 * 60 * 24 * 365.25;
            // Add a full day (24 hours in milliseconds) to ensure both start and end dates are inclusive.
            const MS_PER_DAY = 1000 * 60 * 60 * 24;

            let totalDurationInMs = 0;
            const today = new Date();
            // Set today to the start of the day for consistent calculation
            today.setHours(0, 0, 0, 0); 

            professionalDetails.forEach(job => {
                const startDateStr = job.fromDate;
                let endDateStr = job.toDate;

                // A job must have a start date to count
                if (!startDateStr) return; 

                const startDate = new Date(startDateStr);
                let endDate;

                // Check for ongoing job: if toDate is empty or the job is marked as current
                if (!endDateStr || job.isCurrent === true || job.isCurrent === 'true') {
                    // Use today's date for ongoing jobs
                    endDate = today; 
                } else {
                    // Use the specified end date
                    endDate = new Date(endDateStr);
                }
                
                // Skip invalid dates
                if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                    console.warn(`Invalid date format detected for job: ${job.companyName}`);
                    return;
                }

                // Skip if start date is in the future or end date is before start date
                if (startDate > today || endDate < startDate) {
                    return;
                }

                // Calculate duration in milliseconds. 
                // Add MS_PER_DAY to make the calculation inclusive of the start and end days.
                let durationMs = endDate.getTime() - startDate.getTime() + MS_PER_DAY;
                
                // Safety check: ensure duration is non-negative
                if (durationMs < 0) durationMs = 0; 
                
                totalDurationInMs += durationMs;
            });

            // Convert total milliseconds to years
            const totalYears = totalDurationInMs / MS_PER_YEAR;
            // Calculate and return total years, rounded to two decimal places
            return parseFloat(totalYears.toFixed(2));
        }


        /**
         * Fetches user data from the dedicated backend API endpoint: /api/profile/jobseekers.
         */
        async function fetchUserData() {
            loadingDiv.classList.remove('hidden');
            
            try {
                // IMPORTANT: The backend MUST allow UNPROTECTED access to this endpoint.
                const response = await fetch(`${BASE_URL}/api/jobseekers`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}. Please check backend access policy.`);
                }
                
                const data = await response.json();
                
                const fetchedUsers = data.jobseekers.map(user => {
                    // Robust JSON parsing function for database fields
                    const safeParse = (v) => {
                        if (!v) return [];
                        if (typeof v === 'object' && Array.isArray(v)) return v;
                        if (typeof v === 'string') {
                            try { return JSON.parse(v); } catch (e) { return []; }
                        }
                        return [];
                    };

                    const professionalDetails = safeParse(user.professional_details);
                    const calculatedExperience = calculateTotalExperience(professionalDetails);

                    return {
                        ...user,
                        fullName: user.full_name || user.fullName || 'Jobseeker',
                        experience: calculatedExperience, 
                        ctc_expected: user.ctc_expected,
                        professionalDetails: professionalDetails, 
                        // Use safeParse for all complex fields
                        projects: safeParse(user.projects),
                        skills: safeParse(user.skills).map(s => s.name || s.skillName || s),
                        education: safeParse(user.education),
                        certifications: safeParse(user.certifications),
                        languages: safeParse(user.languages),
                    };
                });
                
                state.allUsers = fetchedUsers;
                applyFilters();

            } catch (error) {
                console.error("Error fetching data from API:", error);
                userCardsContainer.innerHTML = `<div class="p-6 bg-red-100 border border-red-300 text-red-700 rounded-lg text-center mt-8">
                    <i data-lucide="alert-triangle" class="w-6 h-6 inline-block mr-2"></i>
                    Failed to load profiles. Error: ${error.message}
                </div>`;
                lucide.createIcons();
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }
        
        /**
         * Renders the user cards in the container.
         */
        function renderUsers() {
            userCardsContainer.innerHTML = '';
            resultsCountSpan.textContent = state.filteredUsers.length;

            if (state.filteredUsers.length === 0) {
                noResultsDiv.classList.remove('hidden');
                return;
            }
            noResultsDiv.classList.add('hidden');

            state.filteredUsers.forEach(user => {
                const card = document.createElement('div');
                card.onclick = () => showDetailView(user);
                card.className = 'bg-white p-6 rounded-xl border border-gray-100 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.01] cursor-pointer';
                
                const userName = user.fullName || 'Jobseeker';
                const profilePhotoUrl = user.profile_image_url && user.profile_image_url.startsWith('/') 
                                        ? `${BASE_URL}${user.profile_image_url}` 
                                        : user.profile_image_url || 'https://placehold.co/100x100/6366F1/ffffff?text=User';

                const displaySkills = user.skills;
                const experienceDisplay = user.experience ? user.experience.toFixed(1) : '0.0'; 

                card.innerHTML = `
                    <div class="flex items-start space-x-4 mb-4">
                        <img src="${profilePhotoUrl}" 
                             onerror="this.onerror=null;this.src='https://placehold.co/100x100/6366F1/ffffff?text=User';"
                             alt="${userName}" class="w-16 h-16 rounded-full object-cover border-4 border-indigo-500 shadow-md">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">${userName}</h3>
                            <p class="text-sm font-semibold text-indigo-600 mt-0.5">${experienceDisplay} Years Experience</p>
                        </div>
                    </div>

                    <div class="mb-4">
                        <p class="text-xs font-semibold uppercase text-gray-500 mb-2">Top Skills</p>
                        <div class="flex flex-wrap gap-2">
                            ${(displaySkills || []).slice(0, 5).map(skill => 
                                `<span class="px-3 py-1 bg-indigo-100 text-indigo-800 text-xs font-medium rounded-full">${skill}</span>`
                            ).join('')}
                            ${(displaySkills || []).length > 5 ? `<span class="text-xs text-gray-500">and ${displaySkills.length - 5} more...</span>` : ''}
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                        <div class="flex items-center text-gray-600">
                            <i data-lucide="folder-open" class="w-4 h-4 mr-2 text-indigo-500"></i>
                            Projects: <span class="ml-1 font-semibold">${(user.projects || []).length}</span>
                        </div>
                        <!-- REMOVED LOCATION FIELD -->
                        <div class="flex items-center text-gray-600">
                            <i data-lucide="map-pin" class="w-4 h-4 mr-2 text-indigo-500"></i>
                            Available: <span class="ml-1 font-semibold">Yes</span>
                        </div>
                    </div>
                    
                    <button class="w-full inline-flex justify-center items-center px-4 py-2 mt-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 transition duration-150">
                        <i data-lucide="eye" class="w-4 h-4 mr-2"></i>
                        View Full Profile
                    </button>
                `;
                userCardsContainer.appendChild(card);
            });
            lucide.createIcons();
        }

        /**
         * Applies the current filters to the allUsers array.
         */
        function applyFilters() {
            const skillQuery = state.filters.skills.toLowerCase().trim();
            const minExperience = state.filters.experience;

            state.filteredUsers = state.allUsers.filter(user => {
                const passesSkillFilter = skillQuery === '' || (Array.isArray(user.skills) && user.skills.some(skill => 
                    skill.toLowerCase().includes(skillQuery)
                ));
                
                const passesExperienceFilter = (user.experience || 0) >= minExperience;

                return passesSkillFilter && passesExperienceFilter;
            });

            renderUsers();
        }
        
        // --- View Switching Functions ---

        /**
         * Safely parses and formats complex array data (e.g., education, experience).
         */
        const formatArrayData = (arr, renderFn) => {
            let safeArr = Array.isArray(arr) ? arr : [];

            safeArr = safeArr.filter(item => {
                if (item === null || typeof item === 'undefined') return false;
                if (typeof item === 'string' && item.trim() === '') return false;
                // For objects, ensure at least one key is present
                if (typeof item === 'object' && Object.keys(item).length === 0) return false;
                return true;
            });

            if (safeArr.length === 0) {
                return '<span class="text-gray-400 italic text-sm">Not specified.</span>';
            }
            return safeArr.map(renderFn).join('');
        };
        
        /**
         * Creates a structured detailed section for the view.
         */
        const createDetailSection = (title, content) => {
            if (content.includes('Not specified')) return '';
            
            return `
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-indigo-700 border-b pb-1 mb-3">${title}</h4>
                    <div class="space-y-3 text-sm">${content}</div>
                </div>`;
        };
        
        /**
         * Shows the single user detail view and hides the list view.
         * @param {Object} user The full user profile object from the API.
         */
        window.showDetailView = (user) => {
            // Hide the list view
            mainContentList.classList.add('hidden');
            
            // Show loading spinner while preparing content
            userDetailContent.innerHTML = `
                <div class="flex justify-center items-center h-48">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-500"></div>
                    <p class="ml-4 text-indigo-500">Loading user profile...</p>
                </div>
            `;
            
            // Show the detail view container
            userDetailView.classList.remove('hidden');


            const actualUser = user;
            
            // --- Education ---
            const educationItems = formatArrayData(actualUser.education, (edu) => {
                const degree = edu.degree || 'Degree not specified'; 
                const fieldOfStudy = edu.field || 'Field not specified'; 
                const institution = edu.institution || 'Institution not specified';
                const yearOfCompletion = edu.endDate || '';
                
                if (!degree && !fieldOfStudy && !institution) return '';
                return `<div class="p-3 bg-gray-50 rounded-lg">
                    <strong>${degree}</strong> in ${fieldOfStudy}<br>
                    <span class="text-gray-600">${institution}</span>
                    ${yearOfCompletion ? `<br><small class="text-indigo-500">${yearOfCompletion}</small>` : ''}
                </div>`;
            });

            // --- Work Experience (UPDATED: Handle nested 'roles' array and 'companyName') ---
            const experienceItems = formatArrayData(actualUser.professionalDetails, (exp) => {
                // Check if roles is an array and take the first element, otherwise fall back to other fields
                const position = (Array.isArray(exp.roles) && exp.roles.length > 0) 
                               ? exp.roles[0] 
                               : exp.position || exp.role || exp.title || 'Position not specified'; 
                               
                const company = exp.companyName || exp.company || 'Company not specified';

                let duration = 'Duration not specified';
                const startDate = exp.startDate || exp.fromDate; 
                const endDate = exp.toDate || exp.endDate || '';
                
                const isCurrentJob = exp.isCurrent === true || exp.isCurrent === 'true' || (!exp.toDate && !exp.endDate);

                if (isCurrentJob) {
                    duration = `${startDate || 'N/A'} - Present`;
                } else if (startDate && endDate) {
                    duration = `${startDate} - ${endDate}`;
                } else if (exp.duration) {
                     duration = exp.duration; 
                }
                
                if (!company && !position) return '';
                return `<div class="p-3 bg-gray-50 rounded-lg">
                    <strong>${position}</strong> at ${company}<br>
                    <span class="text-gray-600">${duration}</span>
                    ${exp.description ? `<br><small class="text-gray-500">${exp.description.substring(0, 100)}...</small>` : ''}
                </div>`;
            });
            
            // --- Projects (Updated Keys based on image_298814.png) ---
            const projectsItems = formatArrayData(actualUser.projects, (project) => {
                const title = project.projectTitle || project.title || project.name || 'Untitled Project';
                const role = project.role || 'N/A';
                const description = project.description || '';

                if (!title) return '';
                return `<div class="p-3 bg-gray-50 rounded-lg">
                    <strong>${title}</strong> (${role})
                    ${description ? `<br><small class="text-gray-500">${description.substring(0, 100)}...</small>` : ''}
                </div>`;
            });

            // --- Certifications (Updated Keys based on image_298b3e.png) ---
            const certificationsItems = formatArrayData(actualUser.certifications, (cert) => {
                const name = cert.certificationName || cert.name || cert;
                const issuer = cert.issuingOrganization || 'N/A';
                const link = cert.certificationLink || '#';
                const issueDate = cert.issueDate || 'N/A';

                if (!name) return '';
                return `<div class="p-2 bg-gray-50 rounded-lg">
                    <strong>${name}</strong> by ${issuer} (Issued: ${issueDate})
                    ${link !== '#' ? `<a href="${link}" target="_blank" class="text-indigo-500 hover:underline ml-2 text-xs">(View Certificate)</a>` : ''}
                </div>`;
            });


            // --- Other sections (Skills and Languages remain the same) ---
            const skillsItems = formatArrayData(actualUser.skills, (skill) => {
                const skillName = skill.skillName || skill.name || skill;
                if (!skillName || (typeof skillName === 'string' && skillName.trim() === '')) return '';
                return `<span class="px-3 py-1 bg-indigo-100 text-indigo-800 text-xs font-medium rounded-full">${skillName}</span>`;
            });
            
            const languagesHtml = formatArrayData(actualUser.languages, (lang) => {
                const langName = lang.languageName || lang.name || lang;
                const proficiency = lang.proficiency || 'Unknown';
                if (!langName || (typeof langName === 'string' && langName.trim() === '')) return '';
                return `<span class="px-3 py-1 bg-gray-200 text-gray-700 text-xs font-medium rounded-full">${langName} (${proficiency})</span>`;
            });
            
            const profilePhotoBaseUrl = actualUser.profile_image_url && actualUser.profile_image_url.startsWith('/') 
                                        ? `${BASE_URL}${actualUser.profile_image_url}` 
                                        : actualUser.profile_image_url || 'https://placehold.co/100x100/6366F1/ffffff?text=User';
            const resumeUrl = actualUser.resume_url && actualUser.resume_url.startsWith('/') ? `${BASE_URL}${actualUser.resume_url}` : actualUser.resume_url || '#';

            let expectedCtcText = 'Not specified';
            const ctcExpected = actualUser.ctc_expected; 
            if (ctcExpected && !isNaN(parseFloat(ctcExpected))) {
                expectedCtcText = parseFloat(ctcExpected).toLocaleString('en-IN', { style: 'currency', currency: actualUser.ctcCurrency || 'INR', minimumFractionDigits: 0, maximumFractionDigits: 0 });
            }
            
            let experienceDisplay = `${actualUser.experience.toFixed(1)} Years`;
            const userName = actualUser.fullName || actualUser.full_name || 'Jobseeker';


            userDetailContent.innerHTML = `
                <!-- Header -->
                <div class="flex items-center space-x-6 pb-6 border-b border-gray-100 mb-6">
                    <img src="${profilePhotoBaseUrl}" 
                         onerror="this.onerror=null;this.src='https://placehold.co/100x100/6366F1/ffffff?text=User';"
                         alt="${userName}" class="w-24 h-24 rounded-full object-cover border-4 border-indigo-500 shadow-xl">
                    <div>
                        <h3 class="text-3xl font-extrabold text-gray-900">${userName}</h3>
                        <p class="text-md font-semibold text-indigo-600 mt-1">${actualUser.experienceLevel || 'Professional'} (${experienceDisplay})</p>
                    </div>
                </div>

                <!-- Contact & Summary Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-8 p-4 bg-indigo-50 rounded-xl">
                    <div class="flex items-center text-gray-700">
                        <i data-lucide="mail" class="w-4 h-4 mr-3 text-indigo-600"></i>
                        <span class="font-medium">Email:</span> ${actualUser.email || 'N/A'}
                    </div>
                    <div class="flex items-center text-gray-700">
                        <i data-lucide="phone" class="w-4 h-4 mr-3 text-indigo-600"></i>
                        <span class="font-medium">Mobile:</span> ${actualUser.mobile_number || 'N/A'}
                    </div>
                    <div class="flex items-center text-gray-700">
                        <i data-lucide="wallet" class="w-4 h-4 mr-3 text-indigo-600"></i>
                        <span class="font-medium">Expected CTC:</span> ${expectedCtcText}
                    </div>
                    <div class="flex items-center text-gray-700">
                        <i data-lucide="clock" class="w-4 h-4 mr-3 text-indigo-600"></i>
                        <span class="font-medium">Notice Period:</span> ${actualUser.notice_period || 'Immediate'}
                    </div>
                </div>
                
                <!-- Detailed Sections -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        ${createDetailSection('Key Skills', `<div class="flex flex-wrap gap-2">${skillsItems}</div>`)}
                        ${createDetailSection('Work Experience', experienceItems)}
                        ${createDetailSection('Projects', projectsItems)}
                    </div>
                    <div class="lg:col-span-1">
                        ${createDetailSection('Education', educationItems)}
                        ${createDetailSection('Certifications', certificationsItems)}
                        ${createDetailSection('Languages', `<div class="flex flex-wrap gap-2">${languagesHtml}</div>`)}
                    </div>
                </div>
                
                <!-- Resume Link -->
                <div class="mt-8 pt-6 border-t border-gray-100 text-center">
                    <a href="${resumeUrl}" target="_blank" 
                       class="inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-xl shadow-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 disabled:opacity-50"
                       ${actualUser.resume_url ? '' : 'disabled'}>
                        <i data-lucide="download" class="w-5 h-5 mr-3"></i>
                        Download Resume
                    </a>
                </div>
            `;

            // Re-initialize Lucide icons for the new content
            lucide.createIcons();
            // Scroll to the top of the detail view
            userDetailView.scrollTop = 0;
        }

        /**
         * Hides the user detail view and shows the main list view.
         */
        window.showListView = () => {
            userDetailView.classList.add('hidden');
            mainContentList.classList.remove('hidden');
        }
        
        // --- Event Listeners ---

        skillsFilterInput.addEventListener('input', (e) => {
            state.filters.skills = e.target.value;
            applyFilters();
        });

        experienceFilterInput.addEventListener('input', (e) => {
            state.filters.experience = parseInt(e.target.value, 10);
            experienceValueSpan.textContent = `${e.target.value}+`;
            applyFilters();
        });

        clearFiltersButton.addEventListener('click', () => {
            state.filters.skills = '';
            state.filters.experience = 0;
            skillsFilterInput.value = '';
            experienceFilterInput.value = 0;
            experienceValueSpan.textContent = '0+';
            applyFilters();
        });
        
        // Initialize the application on load
        window.onload = () => {
            lucide.createIcons();
            fetchUserData();
            showListView(); // Ensure the list view is visible on load
        };

    </script>
</body>
</html>
